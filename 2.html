<!DOCTYPE html>
<html lang="en">
<head>

    <title>title</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Библиотека с иконками -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
          integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

    <style>
        /* Кнопки стиля */
        .btn {
            background-color: #9be3e6; /* Синий фон */
            border: none;
            color: white;
            padding: 12px 16px;
            font-size: 16px;
            cursor: pointer;
        }
        .btn:hover{
            background-color: #79b5b8;
        }
        .btnDel {
            background-color: #e69889;
        }
        .btnDel:hover {
            background-color: #c47f72;
        }
        .btnAdd {
            background-color: #b8e6a2;
            min-width: 300px;
            min-height: 60px;
        }
        .btnAdd:hover {
            background-color: #98c287;
        }
        .btnClose {
            padding: 12px 16px;
            background-color: rgba(186, 186, 186, 0.98);
        }
        .btnClose:hover {
            background-color: rgba(127, 127, 127, 0.98);
        }
        .btnXmark
        {
            background-color: transparent; /* Синий фон */
            border: none;
        }

        dialog::backdrop {
            background-color: rgba(0, 0, 0, 0.8);
        }

        .addButtonArea
        {
            margin-left: 20px;
            display: flex;
            flex-direction: row-reverse;
            justify-content: left;
            margin-bottom: -50px;
            margin-right: 12px;
        }
        .gridContent
        {
            display: block;overflow-y: scroll;
            margin-top: 2px;
            height: calc(100vh - 250px);
        }

    </style>

</head>
<body onLoad="Start()">

<div class="container-fluid">
    <div class="row min-vh-100 flex-column flex-md-row">
        <aside class="col-12 col-md-2 p-0 bg-dark flex-shrink-1">
            <nav class="navbar navbar-expand navbar-dark bg-dark flex-md-column flex-row align-items-start py-2 sticky-top ">
                <div class="collapse navbar-collapse aside_header__inner">
                    <ul class="flex-md-column flex-row navbar-nav w-100 justify-content-between">
                        <li class="nav-item">
                            <a class="nav-link pl-0 text-nowrap" href="#"><i class="far fa-newspaper"></i> <span class="font-weight-bold">Новини</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link pl-0" href="#"><i class="fas fa-hand-holding-usd"></i> <span class="d-none d-md-inline">Збори коштів</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link pl-0" href="#"><i class="fas fa-globe"></i> <span class="d-none d-md-inline">Події</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link pl-0" href="#"><i class="fas fa-envelope-open-text"></i> <span class="d-none d-md-inline">Перегляд листів</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link pl-0" href="index.html" onclick="Exit()"><i class="fas fa-sign-out-alt"></i> <span class="d-none d-md-inline text-danger">Вихід</span></a>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>


        <main class="col-12 col-md-10 bg-faded flex-grow-1 p-0">

            <header class = "row-fluid pt-3 pb-3  sticky-top" style="background-color: slategrey"  >
                <h3 class = "text-center"> Панель домоуправлінця MyPlace </h3>
            </header>

            <p><h3 class = "text-center">Перелік пов'язаних новин</h3></p>

            <div id = "addButtonArea" class = "addButtonArea">
                <button class = "btn btnAdd" id="show" onclick = "OpenDialog()" ><i class="fas fa-plus" style = "font-size: 50px;"></i></button>
            </div>

            <!-- МЕСТО ДЛЯ ЗАГОЛОВКА ТАБЛИЦЫ -->
            <div id = "tableHeader">
            </div>

            <!-- МЕСТО ДЛЯ СОДЕРЖИМОГО ТАБЛИЦЫ -->
            <div class="gridContent" id="content">
            </div>

            <!-- Modal -->
            <div  class="modal fade" id="NewsModalWindow" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header pb-0 pt-0">
                            <h4 class="modal-title" id="dialogTitle">Вікно для додання новини</h4>
                            <button type="button" class="close btnXmark " onclick='CloseDialogWindow()' aria-label="Close">
                                <span aria-hidden="true" style = "font-size: 50px">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id = "ModalBody">
                            <div id = "news_editor" style="min-width: 500px; display: flex; flex-direction: column; ">
                                <label id = "news_id">ID новини:</label>
                                <label id = "news_house">Дом:</label>
                                <label id = "news_porch">Під`їзд:</label>
                                <label> Заголовок новини </label>
                                <textarea name = "news_title" id = "news_title" placeholder="Заголовок"></textarea>
                                <label> Текст новини </label>
                                <textarea name = "news_body" id = "news_body" style = "min-height: 200px" placeholder="Текст"></textarea>

                                <div id="carouselExampleControls" class="carousel slide pt-4" data-ride="carousel" >
                                    <div class="carousel-inner"  id = "carousel-body">
                                    </div>
                                    <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                    <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </div>
                                <div id = "input_placer" class="row container p-0 m-0 pt-4">

                                </div>
                                <button type="button" class="btn btn-secondary" id="news_add_image" onclick='AddImageField()'>Додати зображення</button>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary btnClose" id="news_close" onclick='CloseDialogWindow()'>Закрити</button>
                            <button type="button" class="btn btn-primary" id="news_save" onclick = "SaveChanges()">Зберігти</button>
                        </div>
                    </div>
                </div>
            </div> <!-- Modal close -->

        </main>
    </div>
</div>

<!-- Reauired by Bootstrap-->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


</body>

<!--СКРИПТ ДЛЯ ОТОБРАЖЕНИЯ КАРТИНОК -->
<script>

    let img_counter = 0; // счётчик для уникальности полей id
    function AddImageField(imgSource = "") {
        let canAdd = true;

        //проверяем заполненны ли предыдушие поля для картинок
        curr_fields = document.getElementsByName("imageField");
        for (i = 0; i < curr_fields.length; i++) {

            //if (curr_fields[i].value === "") {
            if (curr_fields[i].readOnly === false) {
                canAdd = false;
                alert("Empty imgage field. Field #" + (i + 1));
                break;
            }
        }

        // Добавляем новое текстовое поле для ссылки на картинку
        if (canAdd) {
            let temp_counter_val =img_counter;

            t_div = document.createElement('div');
            t_div.className = "d-flex justify-content-between m-0 p-0";
            t_div.id = "helperImageDiv" + temp_counter_val;

            temp_inp = document.createElement('input');
            temp_inp.type = "text";
            temp_inp.name = "imageField";
            temp_inp.placeholder = placeholder = "Лінк на зображення";
            temp_inp.className = "col-8 mb-4";
            temp_inp.id = "imageField" + temp_counter_val;


            temp_inp.oninput = function () {
                addImages(temp_inp.value, temp_counter_val, temp_inp.id);
            };

            delete_butt = document.createElement('button');
            delete_butt.className="col-3  mb-4 btn btn-danger";
            delete_butt.style.backgroundColor = "#e69889";
            delete_butt.innerHTML = "Видалити";
            delete_butt.id = "deleteImageButton" + temp_counter_val;
            delete_butt.onclick = function()
            {
                //alert(parseInt(this.id.substring(17)));
                DeleteImageInfo(temp_counter_val, "helperImageDiv" + parseInt(this.id.substring(17))); // 17-- кол-во символов в "helperImageDiv"
            };


            news_body = document.getElementById('input_placer');
            t_div.appendChild(temp_inp);
            t_div.appendChild(delete_butt);
            news_body.appendChild(t_div);

            //Используеться при обновлении уже созданных новостей
            // imgSource --> ссылка на картинку
            if(imgSource !== "")
            {
                //Вставляем ссылку и блокируем инпут
                temp_inp.value = imgSource;
                temp_inp.readOnly = true;
                temp_inp.style.backgroundColor = "lightGrey";

                addImages(temp_inp.value, temp_counter_val, temp_inp.id);
            }

        }
        img_counter+= 1;
    }

    function DeleteImageInfo(index, helperDiv_id)
    {

        img_div = document.getElementById("imgDiv" + index);
        if(img_div != null) {
            if (img_div.className !== "carousel-item active") {
                img_div.remove();
            }else {
                divs = document.getElementById('carousel-body').children;
                for (i = 0; i < divs.length; i++) {

                    if (divs[i].className !== "carousel-item active") {
                        divs[i].className = "carousel-item active";
                        break;
                    }
                }
                img_div.remove();
            }
        }

        t_div = document.getElementById(helperDiv_id);
        t_div.remove();
    }

    function addImages(src, index, input_id)
    {
        //Блокируем соответствубщий инпут с ссылкой на картинку
        input = document.getElementById(input_id);
        input.readOnly = true;
        input.style.backgroundColor = "lightGrey";


        car_body = document.getElementById('carousel-body');

        //Если емелента еще не существует
        if(!document.getElementById("imgDiv" + index)) {
            img_div = document.createElement('div');
            img_div.name = "imgDiv";
            img_div.id = "imgDiv" + index;

            img = document.createElement('img');
            img.className = "d-block w-100";
            img.id = "imgImg" + index;
            img.height = 300;
            img.onerror = function () {
                img.src = "https://www.aubreydaniels.com/sites/default/files/default_images/x2017-05-15_5.png.pagespeed.ic.tLD9q0ZZph.png";
            };

            // запрашиваем картинку
            img.src = src;

            img_div.appendChild(img);
            car_body.appendChild(img_div);
        }
        else {
            //не вызываеться так как ставим свойство readonly = true
            /*
            // Обновляем существующию картинку
            img_div = document.getElementById("imgDiv" + index);
            img = document.getElementById("imgImg" + index);

            // запрашиваем картинку
            img.src = src;
            console.log("updated");
            $('.carousel').carousel();

             */
        }

        //Следим что бы был ровно 1 carousel-item active
        var temp = document.getElementsByClassName('carousel-item active');
        if(temp.length === 0) {
            img_div.className = "carousel-item active";
        }
        else{
            if(temp[0].id !== img_div.id) {
                img_div.className = "carousel-item";
            }
        }

        SetActive(img_div.id);
    }

    function SetActive(imgDiv_id){

        var img_div = document.getElementById(imgDiv_id);
        img_div.className = "carousel-item active";

        divs = document.getElementById('carousel-body').children;
        for (i = 0; i < divs.length; i++) {

            if (divs[i].id !== imgDiv_id) {
                divs[i].className = "carousel-item";
            }
        }
    }
</script>

<script>

    // При закрытии модального окна
    $('#NewsModalWindow').on('hidden.bs.modal', function (e) {
        // Возвращаем елементы модального окна в исходное состояние
        ClearNewsEditor();

        if(document.getElementById('houseContainer0') !== null){
            DeleteElement('houseContainer0');
        }
        if(document.getElementById('porchContainer0') !== null) {
            DeleteElement('porchContainer0');
        }
    });

    function CloseDialogWindow() {
        $("#NewsModalWindow").modal('hide');
    }

    function ShowDialogWindow()
    {
        $("#NewsModalWindow").modal('show');
    }

    function ClearNewsEditor() {

        document.getElementById('dialogTitle').innerHTML = "Вікно для додання новини";
        document.getElementById("news_id").innerHTML = "";
        document.getElementById("news_house").innerHTML = "";
        document.getElementById("news_porch").innerHTML = "";

        var newsTitle = document.getElementById("news_title");
        newsTitle.value = "";
        newsTitle.placeholder = "Заголовок";

        var newsBody = document.getElementById("news_body");
        newsBody.value = "";
        newsBody.placeholder = "Текст";

        //Возвращаем в дефолт
        document.getElementById('news_save').onclick = function () {
            SaveChanges();
        };

        //Удаляем информацию для роботы с картинками
        DeleteChildren('carousel-body');
        DeleteChildren('input_placer');

        document.getElementById("news_id").hidden = false;
        document.getElementById('news_editor').hidden = false;
    }
</script>
<script>

    function Exit()
    {
        localStorage.clear();
        document.location.href = "index.html";
    }

    let data = {};


    function Start()
    {
        GetNews();
    }

    function OpenDialog() {
        GetHouses();
        ShowDialogWindow();
    }

    //Добавляем выбор домов в диалоговом окне
    function SelectHouses()
    {
        //Заполняем объект houses
        console.log("Данные для SelectHouses(): " + housesData);

        //Скрываем елементы для добавления новости
        document.getElementById('news_editor').hidden = true;

        modal = document.getElementById('ModalBody');

        // добавляем область для домов
        var houseContainer = document.createElement("div");
        houseContainer.className = "container-fluid list-group p-0 m-0";
        houseContainer.id = "houseContainer0";

        modal.appendChild(houseContainer);

        //добавляем надпись
        document.getElementById('dialogTitle').innerHTML = "Оберіть необхідний будинок:";

        //добавляем дома
        // k == idДома
        for(var k in housesData.houses)
        {
            var houseElement = document.createElement("div");

            houseElement.className = "list-group-item list-group-item-action border-2 pt-0";
            houseElement.style.minHeight = "100px";
            houseElement.style.height = "100px";
            houseElement.style.maxWidth = "795px";
            houseElement.style.backgroundColor = "rgba(255,164,51,0.73)";
            houseElement.style.borderColor = "rgba(0,0,0,0.73)";
            houseElement.onmouseover = function(){
                this.style.backgroundColor = "rgba(201,134,38,0.73)";
            };
            houseElement.onmouseleave = function(){
                this.style.backgroundColor = "rgba(255,164,51,0.73)";
            };

            houseElement.id = "houseElement" + k;
            houseElement.name = k;
            houseElement.onclick = function()
            {
                localStorage.setItem("CreateNewsHouse_id", this.name);
                localStorage.setItem("CreateNewsHouseName", this.children[0].innerHTML);
                DeleteElement(houseElement.parentElement.id);
                GetPorches(this.name);
            };

            var houseName = document.createElement("h4");
            houseName.style.textAlign = "left";
            houseName.style.paddingTop = (parseInt(houseElement.style.height) / 3 ) + "px";
            houseName.style.alignSelf = "center";
            houseName.innerHTML = housesData.houses[k].house_number;

            houseElement.appendChild(houseName);
            houseContainer.appendChild(houseElement);
        }
    }

    function DeleteElement(ElementId)
    {
        var el = document.getElementById(ElementId);

        var child = el.lastElementChild;
        while(child)
        {
            el.removeChild(child);
            child = el.lastElementChild;
        }
        el.remove();

    }

    function SelectPorches()
    {
        modal = document.getElementById('ModalBody');

        // добавляем область для подъездов
        var porchContainer = document.createElement("div");
        porchContainer.className = "container-fluid  p-0 m-0";
        porchContainer.id = "porchContainer0";

        modal.appendChild(porchContainer);

        //добавляем надпись
        document.getElementById('dialogTitle').innerHTML = "Оберіть необхідний під`їзд";

        //добавляем кнопку для создания новости
        var porchCreateButton = document.createElement("button");
        porchCreateButton.id = "porchCreateButton";
        porchCreateButton.innerHTML = "Додати новину до " + localStorage.getItem('CreateNewsHouseName');
        porchCreateButton.className = "btn btnAdd mb-4 ";
        porchCreateButton.style.fontSize = "20px";
        porchCreateButton.onclick = function()
        {
            localStorage.setItem("CreateNewsporch_id", "null");
            localStorage.setItem("CreateNewsPorchName", "null");
            DeleteElement(porchContainer.id);
            ShowNewsEditor();
        };
        porchContainer.appendChild(porchCreateButton);

        var porchDivsContainer = document.createElement("div");
        porchDivsContainer.className = "container-fluid list-group p-0 m-0";
        porchDivsContainer.id = "porchDivsContainer0";

        //добавляем подъезды
        //k == News_id
        let firstElem = true;
        for(var k in porchesData.porches)
        {
            var porchElement = document.createElement("div");
            porchElement.className = "list-group-item list-group-item-action border-2 pt-0";
            porchElement.style.height = "100px";
            porchElement.style.maxWidth = "795px";
            porchElement.style.backgroundColor = "rgba(255,198,98,0.73)";
            porchElement.style.borderColor = "rgba(0,0,0,0.73)";
            porchElement.onmouseover = function(){
                this.style.backgroundColor = "rgba(205,154,81,0.73)";
            };
            porchElement.onmouseleave = function(){
                this.style.backgroundColor = "rgba(255,198,98,0.73)";
            };


            porchElement.id = "porchElement" + k;
            porchElement.name = k;
            porchElement.onclick = function()
            {
                localStorage.setItem("CreateNewsPorch_id", this.name);
                localStorage.setItem("CreateNewsPorchName", this.children[0].innerHTML);
                DeleteElement(porchContainer.id);
                ShowNewsEditor();
            };


            var porchName = document.createElement("h4");
            porchName.style.textAlign = "left";
            porchName.style.paddingTop = (parseInt(porchElement.style.height) / 3 ) + "px";
            porchName.style.alignSelf = "center";
            porchName.innerHTML = porchesData.porches[k].porch_name;

            porchElement.appendChild(porchName);
            porchDivsContainer.appendChild(porchElement);
            porchContainer.appendChild(porchDivsContainer);
        }
    }

    //Отображает в диалоговом окне поля для создания новости
    function ShowNewsEditor()
    {
        document.getElementById('dialogTitle').innerHTML="Додавання новини";
        document.getElementById("news_id").hidden = true;
        document.getElementById("news_house").innerHTML = "Дом: " + localStorage.getItem("CreateNewsHouseName");
        if(localStorage.getItem("CreateNewsPorchName") !== "null") {
            document.getElementById("news_porch").innerHTML = "Під`їзд: " + localStorage.getItem("CreateNewsPorchName");
        }
        else{
            document.getElementById("news_porch").innerHTML = "Новина для усього будинку";
        }

        var newsTitle = document.getElementById("news_title");
        newsTitle.value = "";
        newsTitle.placeholder = "Заголовок";

        var newsBody = document.getElementById("news_body");
        newsBody.value = "";
        newsBody.placeholder = "Текст";

        //Запрос на добавление новости
        document.getElementById('news_save').onclick = function(){
            const temp_body =
                {
                    house_id: parseInt(localStorage.getItem("CreateNewsHouse_id")),
                    title: document.getElementById("news_title").value,
                    text: document.getElementById("news_body").value
                };
            if(localStorage.getItem("CreateNewsPorchName") !== "null")
            {
                temp_body.porch_id = parseInt(localStorage.getItem("CreateNewsPorch_id"));
            }
            // Берем ссылки на картинки
            var temp_obj = [];
            divs = document.getElementById('carousel-body').children;
            for (i = 0; i < divs.length; i++) {
                temp_obj[i] = divs[i].children[0].src;
            }
            temp_body.images = temp_obj;
            console.log("ok");
            console.log(temp_body);

            AddNews(temp_body);
            CloseDialogWindow();

        };
        document.getElementById('news_editor').hidden = false;
    }

    function NewsTableHeader()
    {
        if(document.getElementById("NewsTableHeader"))
        {
            return;
        }

        var parBlock = document.createElement("div");
        parBlock.id = "NewsTableHeader";
        parBlock.style.display = "flex";
        parBlock.style.marginTop="50px";
        parBlock.style.marginBottom = "-17px";

        var elem1 = document.createElement("div");
        var elem2 = document.createElement("div");
        var elem3 = document.createElement("div");
        var elem4 = document.createElement("div");
        var elem5 = document.createElement("div");
        var elem6 = document.createElement("div");
        elem1.style.marginLeft = "2px";
        elem6.style.marginRight = "2px";

        elem1.style.width = "10%";
        elem2.style.width = "10%";
        elem3.style.width = "20%";
        elem4.style.width = "40%";
        elem5.style.width = "10%";
        elem6.style.width = "10%";
        elem1.style.wordWrap = "break-word";
        elem2.style.wordWrap = "break-word";
        elem3.style.wordWrap = "break-word";
        elem4.style.wordWrap = "break-word";
        elem5.style.wordWrap = "break-word";
        elem6.style.wordWrap = "break-word";
        var pel1 = document.createElement("p");
        var pel2 = document.createElement("p");
        var pel3 = document.createElement("p");
        var pel4 = document.createElement("p");
        var pel5 = document.createElement("p");
        var pel6 = document.createElement("p");
        pel1.style.textAlign = "center";
        pel2.style.textAlign = "center";
        pel3.style.textAlign = "center";
        pel4.style.textAlign = "center";
        pel5.style.textAlign = "center";
        pel6.style.textAlign = "center";
        pel1.style.fontSize = "25px";
        pel2.style.fontSize = "25px";
        pel3.style.fontSize = "25px";
        pel4.style.fontSize = "25px";
        pel5.style.fontSize = "25px";
        pel6.style.fontSize = "25px";
        pel1.style.fontFamily = "Century Gothic";
        pel2.style.fontFamily = "Century Gothic";
        pel3.style.fontFamily = "Century Gothic";
        pel4.style.fontFamily = "Century Gothic";
        pel5.style.fontFamily = "Century Gothic";
        pel6.style.fontFamily = "Century Gothic";


        pel1.innerHTML = "Дім";
        pel2.innerHTML = "Під`їзд";
        pel3.innerHTML = "Заголовок";
        pel4.innerHTML = "Текст новини";
        pel5.innerHTML = "Редагувати";
        pel6.innerHTML = "Видалити";
        elem1.appendChild(pel1);
        elem2.appendChild(pel2);
        elem3.appendChild(pel3);
        elem4.appendChild(pel4);
        elem5.appendChild(pel5);
        elem6.appendChild(pel6);

        parBlock.appendChild(elem1);
        parBlock.appendChild(elem2);
        parBlock.appendChild(elem3);
        parBlock.appendChild(elem4);
        parBlock.appendChild(elem5);
        parBlock.appendChild(elem6);
        document.getElementById("tableHeader").appendChild(parBlock);
    }

    function DeleteChildren(ElementId)
    {
        var el = document.getElementById(ElementId);

        var child = el.lastElementChild;
        while(child)
        {
            el.removeChild(child);
            child = el.lastElementChild;
        }
    }

    function FillNews(){

        //отображаем оглавление таблицы
        NewsTableHeader();

        //Удаляем элементы при повторном отображении
        DeleteChildren('content');

        let first = true;
        for(var key in data.news){

            var parBlock = document.createElement("div");
            parBlock.style.display = "flex";
            parBlock.id = "parBlock"+key;

            if(!first) {
                parBlock.style.marginTop = "10px";
            }
            else
            {
                parBlock.style.marginTop = "2px";
                first = false;
            }

            var elem1 = document.createElement("div");
            var elem2 = document.createElement("div");
            var elem3 = document.createElement("div");
            var elem4 = document.createElement("div");
            var elem5 = document.createElement("div");
            var elem6 = document.createElement("div");
            elem1.style.marginLeft = "2px";
            elem6.style.marginRight = "2px";

            elem1.style.outline = "2px solid #000";
            elem2.style.outline = "2px solid #000";
            elem3.style.outline = "2px solid #000";
            elem4.style.outline = "2px solid #000";

            elem1.style.backgroundColor = "rgba(255,164,51,0.73)";
            elem2.style.backgroundColor = "rgba(255,164,51,0.73)";
            elem3.style.backgroundColor = "rgba(255,164,51,0.73)";
            elem4.style.backgroundColor = "rgba(255,164,51,0.73)";

            elem1.style.width = "10%";
            elem2.style.width = "10%";
            elem3.style.width = "20%";
            elem4.style.width = "40%";
            elem5.style.width = "10%";
            elem6.style.width = "10%";
            elem1.style.wordWrap = "break-word";
            elem2.style.wordWrap = "break-word";
            elem3.style.wordWrap = "break-word";
            elem4.style.wordWrap = "break-word";
            elem5.style.wordWrap = "break-word";
            elem6.style.wordWrap = "break-word";
            var pel1 = document.createElement("p");
            var pel2 = document.createElement("p");
            var pel3 = document.createElement("p");
            var pel4 = document.createElement("p");
            var pel5 = document.createElement("button");
            var pel6 = document.createElement("button");
            pel3.id="title"+key;
            pel3.name = key;
            pel4.id="text"+key;
            pel4.name = key;
            pel5.style.marginLeft="20%";
            pel5.style.marginTop="5%";
            pel6.style.marginTop="5%";
            pel6.style.marginLeft="20%";
            pel5.style.minWidth = "120px";
            pel6.style.minWidth = "120px";
            pel6.style.minHeight = "40px";
            pel5.style.minHeight = "40px";
            pel1.style.textAlign = "center";
            pel2.style.textAlign = "center";
            pel3.style.textAlign = "center";
            pel4.style.textAlign = "center";
            pel5.style.textAlign = "center";
            pel6.style.textAlign = "center";
            pel1.style.fontFamily = "Century Gothic";
            pel1.style.fontSize = "20px";
            pel2.style.fontSize = "20px";
            pel3.style.fontSize = "20px";
            pel4.style.fontSize = "20px";
            pel2.style.fontFamily = "Century Gothic";
            pel3.style.fontFamily = "Century Gothic";
            pel4.style.fontFamily = "Century Gothic";
            pel5.style.fontFamily = "Century Gothic";
            pel6.style.fontFamily = "Century Gothic";

            pel5.innerHTML = "<i class='fas fa-pen-square' style = 'font-size: 28px;'></i>";
            pel5.className = "btn";
            pel5.id = "changeBut"+key;
            pel5.name = key;

            // Нажатие на кнопку "Редактировать"
            pel5.onclick= async function() {
                //Получаем данные новости
                await GetOneNews(this.name);
            };

            pel6.className = "btn btnDel";
            pel6.innerHTML = "<i class='far fa-trash-alt' style = 'font-size: 28px;'></i>";
            pel6.id = "deleteBut"+key;
            pel6.name = key;

            pel6.onclick= function() {
                DeleteNews(this.name);
            };

            // Вывод локации и номер дома
            pel1.innerHTML = data.news[key]['house_location'] + ' ' +data.news[key]['house_number'];
            // Проверка на наличие подьезда
            if(data.news[key]['porch_name'] == null){
                pel2.innerHTML = 'Усі мешканці'
            } else {
                pel2.innerHTML = data.news[key]['porch_name'];
            }
            pel3.innerHTML = (data.news[key]['title'].length > 50) ? data.news[key]['title'].substr(0,50) + "..." : data.news[key]['title'];
            pel4.innerHTML = (data.news[key]['text'].length > 100) ? data.news[key]['text'].substr(0,100) + "..." : data.news[key]['text'];
            elem1.appendChild(pel1);
            elem2.appendChild(pel2);
            elem3.appendChild(pel3);
            elem4.appendChild(pel4);
            elem5.appendChild(pel5);
            elem6.appendChild(pel6);

            parBlock.appendChild(elem1);
            parBlock.appendChild(elem2);
            parBlock.appendChild(elem3);
            parBlock.appendChild(elem4);
            parBlock.appendChild(elem5);
            parBlock.appendChild(elem6);
            document.getElementById("content").appendChild(parBlock);
        }
    }

    function EditNews() {
        console.log(oneNewsData.news.news_id);
        console.log("^^^");

        document.getElementById('news_id').innerHTML = "ID Новини:" + oneNewsData.news.news_id;
        document.getElementById('news_id').name = oneNewsData.news.news_id;
        document.getElementById('news_title').value = oneNewsData.news.title;
        document.getElementById('news_body').value = oneNewsData.news.text;
        document.getElementById('news_house').innerHTML = "Дім: " + oneNewsData.news.house_number;

        document.getElementById('news_porch').innerHTML = (oneNewsData.news.porch_name != null) ? "Під'їзд: " + oneNewsData.news.porch_name : "Під'їзд: Новина для усього будинку";
        document.getElementById('dialogTitle').innerHTML = "Редагування новини";

        //Учитываем картинки
        if(oneNewsData.images !== null) {
            for (let i = 0; i < oneNewsData.images.length; i++) {
                AddImageField(oneNewsData.images[i]);
            }
            console.log(oneNewsData.images.length);
        }


        // Функция для обновления новости при нажатии на кнопку Сохранить
        document.getElementById('news_save').onclick = async function () {
            //Отправляем новые данные на сервер
            const temp_body =
                {
                    title: document.getElementById('news_title').value,
                    text: document.getElementById('news_body').value
                };
            // Берем ссылки на картинки
            var temp_obj = [];
            divs = document.getElementById('carousel-body').children;
            for (i = 0; i < divs.length; i++) {
                temp_obj[i] = divs[i].children[0].src;
            }
            temp_body.images = temp_obj;

            console.log("temmpmpmp");
            console.log(temp_body);
            await UpdateNews(oneNewsData.news.news_id, temp_body);

            CloseDialogWindow();
        };

        //отображаем текущюю информацию о новости
        ShowDialogWindow();
    }

    async function GetNews()
    {

        const head =
            {
                'Content-type': 'application/json; charset=UTF-8',
                'Authorization': 'Bearer ' + localStorage.getItem('houseKeeperToken')
            };

        fetch('https://prp-project-server.herokuapp.com/api/news/', {
            method: 'GET',
            headers: head
        })
            .then(response => response.json())
            .then(NewsData => {
                console.log('Success:', NewsData);
                //Если закончилось время длительности токена
                if(NewsData.error_message && NewsData.error_message.indexOf("token") !== -1)
                {
                    alert("Час сессії було вичерпано. Якщо ві бажаєте продовжити роботу, виконайте повторний вхід");
                    Exit();
                }

                data = NewsData;
                FillNews();
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        return true;
    }

    oneNewsData = {};
    async function GetOneNews(news_id)
    {
        const head =
            {
                'Content-type': 'application/json; charset=UTF-8',
                'Authorization': 'Bearer ' + localStorage.getItem('houseKeeperToken')
            };

        fetch('https://prp-project-server.herokuapp.com/api/news/' + news_id, {
            method: 'GET',
            headers: head
        })
            .then(response => response.json())
            .then(NewsData => {
                console.log('Success:', NewsData);
                oneNewsData  = NewsData;
                EditNews();
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        return true;
    }

    var housesData = {};
    function GetHouses()
    {
        const head =
            {
                'Content-type': 'application/json; charset=UTF-8',
                'Authorization': 'Bearer ' + localStorage.getItem('houseKeeperToken')
            };

        fetch('https://prp-project-server.herokuapp.com/api/house/', {
            method: 'GET',
            headers: head,
        })
            .then(response => response.json())
            .then(HousesData => {
                console.log('Success:', HousesData);
                housesData= HousesData;
                SelectHouses();
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }

    var porchesData = {};
    function GetPorches(houseId)
    {
        const head =
            {
                'Content-type': 'application/json; charset=UTF-8',
                'Authorization': 'Bearer ' + localStorage.getItem('houseKeeperToken')
            };

        fetch('https://prp-project-server.herokuapp.com/api/porch/' + houseId, {
            method: 'GET',
            headers: head,
        })
            .then(response => response.json())
            .then(Data => {
                console.log('Success:', Data);
                porchesData = Data;
                SelectPorches();
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }

    function DeleteNews(newsId)
    {
        const head =
            {
                'Content-type': 'application/json; charset=UTF-8',
                'Authorization': 'Bearer ' + localStorage.getItem('houseKeeperToken')
            };

        fetch('https://prp-project-server.herokuapp.com/api/news/' + newsId, {
            method: 'DELETE',
            headers: head,
        })
            .then(response => response.json())
            .then(NewsData => {
                console.log('Success:', NewsData);
                console.log("deleted");
                GetNews();
            })
            .catch((error) => {
                console.error('Error:', error);
            });



        //delete data.news[newsId];
        //document.getElementById("parBlock"+newsId).remove();

    }

    function UpdateNews(newsId, newsData) {
        const head =
            {
                'Content-type': 'application/json; charset=UTF-8',
                'Authorization': 'Bearer ' + localStorage.getItem('houseKeeperToken')
            };
        fetch('https://prp-project-server.herokuapp.com/api/news/' + newsId, {
            method: 'PUT',
            headers: head,
            body: JSON.stringify(newsData)
        })
            .then(response => response.json())
            .then(NewsData => {
                console.log('Success:', NewsData);
                console.log("updated");
                // Обновляем локальный json
                // с учетом возможности изменения id в бд
                GetNews();
            })
            .catch((error) => {
                console.error('Error:', error);
            });

    }

    function AddNews(newsData) {
        const head =
            {
                'Content-type': 'application/json; charset=UTF-8',
                'Authorization': 'Bearer ' + localStorage.getItem('houseKeeperToken')
            };
        fetch('https://prp-project-server.herokuapp.com/api/news/', {
            method: 'POST',
            headers: head,
            body: JSON.stringify(newsData)
        })
            .then(response => response.json())
            .then(NewsData => {
                console.log('Success:', NewsData);
                console.log("NewsAdded");
                GetNews();
            })
            .catch((error) => {
                console.error('Error:', error);
            });



    }

    function SaveChanges(){

    }

</script>
</html>